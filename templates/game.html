<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- Animate.css for enhanced animations -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/game.css') }}"
    />
    <title>Ludo Game Board</title>
  </head>
  <body>
    <div class="container-fluid">
      <!-- Game Header with Configuration Display -->
      <div class="game-header">
        <div class="d-flex justify-content-between align-items-center">
          <h1 class="game-title">
            <i class="fas fa-dice-six me-2"></i>
            Ludo Master
          </h1>

          <!-- Configuration Display moved to header -->
          <div class="header-config-display d-flex align-items-center">
            <div class="config-item me-3">
              <i class="fas fa-users me-1"></i>
              <span class="config-label">Players:</span>
              <span class="config-value" id="display-players"
                >{{ num_players }}</span
              >
            </div>
            <div class="config-item me-3">
              <i class="fas fa-chess-pawn me-1"></i>
              <span class="config-label">Tokens:</span>
              <span class="config-value" id="display-tokens"
                >{{ num_tokens }}</span
              >
            </div>
            <div class="config-item me-4">
              <i class="fas fa-th-large me-1"></i>
              <span class="config-label">Board:</span>
              <span class="config-value" id="display-board-size"
                >{{ board_size }}</span
              >
            </div>
          </div>

          <div class="game-controls">
            <button class="btn btn-outline-primary me-2" onclick="goHome()">
              <i class="fas fa-home me-1"></i> Home
            </button>
            <button class="btn btn-warning me-2" onclick="openGameInfo()">
              <i class="fas fa-scroll me-1"></i> Game Info
            </button>
            <button class="btn btn-info me-2" onclick="openGameLogs()">
              <i class="fas fa-clipboard-list me-1"></i> Game Logs
            </button>
            <button class="btn btn-success" onclick="regenerateBoard()">
              <i class="fas fa-sync me-1"></i> New Game
            </button>
          </div>
        </div>
      </div>

      <!-- Game Board Container - Full width and height -->
      <div class="game-container">
        <div class="board-wrapper">
          <div id="ludoBoard" class="ludo-board"></div>
        </div>

        <!-- 3D Dice Container - Bottom Left -->
        <div class="dice-container">
          <div class="dice-card">
            <div class="dice-header">
              <h5 class="dice-title">
                <i class="fas fa-dice me-2"></i>
                Roll Dice
              </h5>
              <div class="current-player">
                <span class="player-indicator" id="currentPlayerIndicator"
                  >Player 1</span
                >
              </div>
            </div>

            <div class="dice-area">
              <!-- Three 3D Dice -->
              <div class="dice-wrapper">
                <div class="dice" id="dice1">
                  <div class="dice-face dice-face-1" data-value="1">
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-2" data-value="2">
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-3" data-value="3">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-4" data-value="4">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-5" data-value="5">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-6" data-value="6">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                </div>

                <div class="dice" id="dice2">
                  <div class="dice-face dice-face-1" data-value="1">
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-2" data-value="2">
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-3" data-value="3">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-4" data-value="4">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-5" data-value="5">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-6" data-value="6">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                </div>

                <div class="dice" id="dice3">
                  <div class="dice-face dice-face-1" data-value="1">
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-2" data-value="2">
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-3" data-value="3">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-4" data-value="4">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-5" data-value="5">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <div class="dice-face dice-face-6" data-value="6">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                </div>
              </div>

              <!-- Dice Values Display -->
              <div class="dice-values" id="diceValues">
                <div class="dice-value" id="value1">1</div>
                <div class="dice-value" id="value2">2</div>
                <div class="dice-value" id="value3">3</div>
              </div>
            </div>

            <!-- Roll Button -->
            <div class="dice-controls">
              <button
                class="btn-roll-dice"
                id="rollDiceBtn"
                onclick="rollDice()"
              >
                <i class="fas fa-dice-d6 me-2"></i>
                <span class="roll-text">Roll Dice</span>
                <div class="roll-effects"></div>
              </button>

              <!-- Move Sequence Display -->
              <div class="move-sequence" id="moveSequence">
                <div class="sequence-info">Next moves:</div>
                <div class="move-order" id="moveOrder">
                  <span class="move-step player-1">P1</span>
                  <span class="move-step player-2">P2</span>
                  <span class="move-step player-1">P1</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Logs Modal -->
    <div
      class="modal fade"
      id="gameLogsModal"
      tabindex="-1"
      aria-labelledby="gameLogsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content logs-modal-content">
          <div class="modal-header logs-modal-header">
            <div class="logs-header-content">
              <h3 class="modal-title logs-modal-title" id="gameLogsModalLabel">
                <i class="fas fa-chart-line me-3"></i>
                Game Analytics & Move History
              </h3>
              <div class="logs-stats-summary">
                <div class="stat-item">
                  <span class="stat-label">Total Moves:</span>
                  <span class="stat-value" id="totalMovesCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Current Round:</span>
                  <span class="stat-value" id="currentRoundDisplay">1</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Game Duration:</span>
                  <span class="stat-value" id="gameDurationDisplay">00:00</span>
                </div>
              </div>
            </div>
            <button
              type="button"
              class="btn-close logs-btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body logs-modal-body">
            <!-- Filter Controls -->
            <div class="logs-filter-section">
              <div class="filter-group">
                <label class="filter-label">Filter by Player:</label>
                <div class="filter-buttons">
                  <button class="filter-btn active" data-filter="all">
                    All Players
                  </button>
                  <button class="filter-btn player-1" data-filter="1">
                    Player 1
                  </button>
                  <button class="filter-btn player-2" data-filter="2">
                    Player 2
                  </button>
                  <button
                    class="filter-btn player-3"
                    data-filter="3"
                    style="display: none"
                  >
                    Player 3
                  </button>
                  <button
                    class="filter-btn player-4"
                    data-filter="4"
                    style="display: none"
                  >
                    Player 4
                  </button>
                </div>
              </div>

              <div class="filter-group">
                <label class="filter-label">Move Type:</label>
                <div class="filter-buttons">
                  <button class="filter-btn active" data-type="all">
                    All Moves
                  </button>
                  <button class="filter-btn" data-type="regular">
                    Regular
                  </button>
                  <button class="filter-btn" data-type="bonus">Bonus</button>
                  <button class="filter-btn" data-type="capture">
                    Captures
                  </button>
                  <button class="filter-btn" data-type="finish">
                    Finishes
                  </button>
                </div>
              </div>
            </div>

            <!-- Game Statistics Dashboard -->
            <div class="logs-dashboard">
              <div class="dashboard-row">
                <div class="dashboard-card player-stats-card">
                  <h5 class="card-title">
                    <i class="fas fa-users"></i>
                    Player Statistics
                  </h5>
                  <div class="player-stats-grid" id="playerStatsGrid">
                    <!-- Player stats will be populated here -->
                  </div>
                </div>

                <div class="dashboard-card dice-analytics-card">
                  <h5 class="card-title">
                    <i class="fas fa-dice-six"></i>
                    Dice Analytics
                  </h5>
                  <div class="dice-stats" id="diceStatsContainer">
                    <!-- Dice statistics will be populated here -->
                  </div>
                </div>
              </div>

              <div class="dashboard-row">
                <div class="dashboard-card recent-activity-card">
                  <h5 class="card-title">
                    <i class="fas fa-clock"></i>
                    Recent Activity
                  </h5>
                  <div class="recent-activity-list" id="recentActivityList">
                    <!-- Recent activities will be populated here -->
                  </div>
                </div>

                <div class="dashboard-card game-progress-card">
                  <h5 class="card-title">
                    <i class="fas fa-trophy"></i>
                    Game Progress
                  </h5>
                  <div class="progress-visualization" id="gameProgressViz">
                    <!-- Progress bars will be populated here -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Detailed Move Logs -->
            <div class="logs-timeline-section">
              <h4 class="timeline-title">
                <i class="fas fa-history me-2"></i>
                Detailed Move Timeline
              </h4>
              <div class="logs-timeline" id="gameLogsTimeline">
                <!-- Timeline entries will be populated here -->
              </div>
            </div>
          </div>

          <div class="modal-footer logs-modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary"
              onclick="exportGameLogs()"
            >
              <i class="fas fa-download me-2"></i>
              Export Logs
            </button>
            <button
              type="button"
              class="btn btn-outline-danger"
              onclick="clearGameLogs()"
            >
              <i class="fas fa-trash me-2"></i>
              Clear Logs
            </button>
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              <i class="fas fa-times me-2"></i>
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Info Modal - Ancient Scroll Style -->
    <div
      class="modal fade"
      id="gameInfoModal"
      tabindex="-1"
      aria-labelledby="gameInfoModalLabel"
      aria-hidden="true"
    >
      <div
        class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered"
      >
        <div class="modal-content scroll-modal-content">
          <!-- Scroll Header -->
          <div class="scroll-header">
            <div class="scroll-rod scroll-rod-left"></div>
            <div class="scroll-rod scroll-rod-right"></div>
            <div class="scroll-title-section">
              <h2 class="scroll-title" id="gameInfoModalLabel">
                <i class="fas fa-dice-d20 me-3"></i>
                The Ancient Art of 3-Dice Ludo
              </h2>
              <div class="scroll-subtitle">
                A Revolutionary Gaming Experience
              </div>
            </div>
            <button
              type="button"
              class="scroll-close-btn"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>

          <!-- Scroll Body -->
          <div class="modal-body scroll-body">
            <div class="scroll-content">
              <!-- Introduction Section -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-star-of-life"></i>
                  Welcome, Noble Player!
                </h3>
                <div class="section-content">
                  <p class="scroll-text">
                    Prepare yourself for an extraordinary twist on the classic
                    game of Ludo! Our innovative
                    <strong>3-Dice Revolutionary System</strong> transforms the
                    traditional gameplay into an epic battle of strategy, luck,
                    and shared destiny.
                  </p>
                </div>
              </div>

              <!-- The Magic of Three Dice -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-dice-three"></i>
                  The Magic of Three Dice
                </h3>
                <div class="section-content">
                  <div class="magic-dice-container">
                    <div class="magic-dice">
                      <div class="dice-icon">üé≤</div>
                      <div class="dice-label">First Die</div>
                      <div class="dice-description">For the roller</div>
                    </div>
                    <div class="magic-dice">
                      <div class="dice-icon">üé≤</div>
                      <div class="dice-label">Second Die</div>
                      <div class="dice-description">For the opponent</div>
                    </div>
                    <div class="magic-dice">
                      <div class="dice-icon">üé≤</div>
                      <div class="dice-label">Third Die</div>
                      <div class="dice-description">Back to the roller</div>
                    </div>
                  </div>
                  <p class="scroll-text">
                    Unlike traditional Ludo where you roll for yourself, our
                    system creates a
                    <strong>shared fate</strong> between players. When you roll
                    three dice, you're not just helping yourself - you're also
                    giving your opponent a chance to move!
                  </p>
                </div>
              </div>

              <!-- How a Turn Works -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-sync-alt"></i>
                  How a Turn Unfolds
                </h3>
                <div class="section-content">
                  <div class="turn-flow">
                    <div class="flow-step">
                      <div class="step-number">1</div>
                      <div class="step-content">
                        <strong>The Roll</strong>
                        <p>Player rolls all three dice simultaneously</p>
                      </div>
                    </div>
                    <div class="flow-arrow">‚¨áÔ∏è</div>
                    <div class="flow-step">
                      <div class="step-number">2</div>
                      <div class="step-content">
                        <strong>First Move</strong>
                        <p>Roller uses the first die value</p>
                      </div>
                    </div>
                    <div class="flow-arrow">‚¨áÔ∏è</div>
                    <div class="flow-step">
                      <div class="step-number">3</div>
                      <div class="step-content">
                        <strong>Opponent's Turn</strong>
                        <p>Opponent uses the second die value</p>
                      </div>
                    </div>
                    <div class="flow-arrow">‚¨áÔ∏è</div>
                    <div class="flow-step">
                      <div class="step-number">4</div>
                      <div class="step-content">
                        <strong>Final Move</strong>
                        <p>Roller uses the third die value</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Bonus Moves Magic -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-magic"></i>
                  The Bonus Moves Magic
                </h3>
                <div class="section-content">
                  <div class="bonus-triggers">
                    <div class="bonus-trigger">
                      <div class="trigger-icon">‚öÖ</div>
                      <div class="trigger-title">Rolling a Six</div>
                      <div class="trigger-desc">Get another dice roll!</div>
                    </div>
                    <div class="bonus-trigger">
                      <div class="trigger-icon">üè†</div>
                      <div class="trigger-title">Reaching Home</div>
                      <div class="trigger-desc">
                        Token finishes, earn bonus!
                      </div>
                    </div>
                    <div class="bonus-trigger">
                      <div class="trigger-icon">‚öîÔ∏è</div>
                      <div class="trigger-title">Capturing Enemy</div>
                      <div class="trigger-desc">
                        Send opponent back, get reward!
                      </div>
                    </div>
                  </div>
                  <p class="scroll-text">
                    These magical events can create
                    <strong>incredible chain reactions</strong>! You might roll
                    a six, capture an enemy, and get another bonus - creating
                    epic turns that can completely change the game!
                  </p>
                </div>
              </div>

              <!-- Token Strategy -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-chess-pawn"></i>
                  Token Movement Strategy
                </h3>
                <div class="section-content">
                  <div class="strategy-card">
                    <div class="strategy-header">
                      <i class="fas fa-brain"></i>
                      <span>Smart Token Selection</span>
                    </div>
                    <div class="strategy-body">
                      <p>
                        Our intelligent system automatically chooses the best
                        token to move:
                      </p>
                      <ul class="strategy-list">
                        <li>
                          üéØ <strong>Focus First:</strong> Move one token at a
                          time to completion
                        </li>
                        <li>
                          üèÉ‚Äç‚ôÇÔ∏è <strong>No Splitting:</strong> Don't spread moves
                          across all tokens
                        </li>
                        <li>
                          üèÜ <strong>Finish Line:</strong> Once a token reaches
                          home, move the next one
                        </li>
                        <li>
                          üéÆ <strong>No Decisions:</strong> System handles
                          strategy, you enjoy the game!
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Safe Zones and Captures -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-shield-alt"></i>
                  Safe Zones & Epic Battles
                </h3>
                <div class="section-content">
                  <div class="battle-system">
                    <div class="battle-card safe">
                      <div class="card-icon">üõ°Ô∏è</div>
                      <div class="card-title">Safe Zones</div>
                      <div class="card-desc">
                        Purple starred squares are <strong>sanctuaries</strong>!
                        No token can be captured here. Use them wisely for
                        protection!
                      </div>
                    </div>
                    <div class="battle-card danger">
                      <div class="card-icon">‚öîÔ∏è</div>
                      <div class="card-title">Battle Zones</div>
                      <div class="card-desc">
                        Land on an enemy token outside safe zones?
                        <strong>CAPTURED!</strong> Send them back to start and
                        earn a bonus move!
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Victory Conditions -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-crown"></i>
                  Path to Victory
                </h3>
                <div class="section-content">
                  <div class="victory-path">
                    <div class="victory-step">
                      <div class="victory-icon">üéØ</div>
                      <div class="victory-text">
                        <strong>The Goal:</strong> Get all your tokens to the
                        center home area
                      </div>
                    </div>
                    <div class="victory-step">
                      <div class="victory-icon">‚è±Ô∏è</div>
                      <div class="victory-text">
                        <strong>Time Limit:</strong> Maximum 24 moves per player
                        (no endless games!)
                      </div>
                    </div>
                    <div class="victory-step">
                      <div class="victory-icon">üèÜ</div>
                      <div class="victory-text">
                        <strong>Winner:</strong> First player to get all tokens
                        home wins the crown!
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Why It's Revolutionary -->
              <div class="scroll-section">
                <h3 class="section-title">
                  <i class="fas fa-rocket"></i>
                  Why This Changes Everything
                </h3>
                <div class="section-content">
                  <div class="revolution-points">
                    <div class="revolution-point">
                      <div class="point-icon">ü§ù</div>
                      <div class="point-content">
                        <strong>Shared Destiny:</strong> Your roll helps
                        opponents too - creates unexpected alliances and
                        rivalries!
                      </div>
                    </div>
                    <div class="revolution-point">
                      <div class="point-icon">‚ö°</div>
                      <div class="point-content">
                        <strong>Faster Gameplay:</strong> More moves per turn
                        means quicker, more exciting games!
                      </div>
                    </div>
                    <div class="revolution-point">
                      <div class="point-icon">üé¢</div>
                      <div class="point-content">
                        <strong>Dramatic Comebacks:</strong> Bonus chains can
                        create incredible comeback moments!
                      </div>
                    </div>
                    <div class="revolution-point">
                      <div class="point-icon">üß†</div>
                      <div class="point-content">
                        <strong>Strategic Depth:</strong> Plan not just your
                        moves, but anticipate how your rolls affect others!
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Final Wisdom -->
              <div class="scroll-section final-wisdom">
                <h3 class="section-title">
                  <i class="fas fa-gem"></i>
                  Ancient Wisdom
                </h3>
                <div class="section-content">
                  <div class="wisdom-quote">
                    <div class="quote-mark">"</div>
                    <div class="quote-text">
                      In this realm of three dice, victory belongs not to the
                      luckiest, but to those who understand that
                      <strong>helping your opponent</strong>
                      is sometimes the path to your own triumph.
                      <br /><br />
                      May your dice be ever in your favor, and your strategies
                      ever wise!
                    </div>
                    <div class="quote-mark">"</div>
                  </div>
                  <div class="wisdom-signature">~ The Ancient Ludo Masters</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Scroll Footer -->
          <div class="scroll-footer">
            <div class="scroll-rod scroll-rod-bottom-left"></div>
            <div class="scroll-rod scroll-rod-bottom-right"></div>
            <div class="footer-content">
              <button
                type="button"
                class="btn scroll-btn"
                data-bs-dismiss="modal"
              >
                <i class="fas fa-scroll me-2"></i>
                Close the Ancient Scroll
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pass Flask data to JavaScript -->
    <script>
      window.gameConfig = {
        numPlayers: "{{ num_players }}",
        numTokens: "{{ num_tokens }}",
        boardSize: "{{ board_size }}",
      };
      console.log("Game config loaded:", window.gameConfig);
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script
      type="module"
      src="{{ url_for('static', filename='js/game.js') }}"
    ></script>
    <!-- Dice JS -->
    <script src="{{ url_for('static', filename='js/dice.js') }}"></script>
  </body>
</html>
